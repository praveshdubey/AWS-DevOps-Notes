=================Session 39 17th oct=============
Jenkin 1st session:-
--------------------------

http://98.130.46.183:8080/

=================================================================


JENINS IS A CI/CD TOOL.
REALITY: JENKINS IS ONLY FOR CI.
        
CI : CONTINOUS INTEGRATION : CONTINOUS BUILD + CONTINOUS TEST (OLD CODE WITH NEW CODE)


DAY-1: 100 LINES : BUILD + TEST
DAY-2: 200 LINES : BUILD + TEST
DAY-3: 300 LINES : BUILD + TEST


BEFORE CI:
MANUAL PROCESS
TIME WASTE


AFTER CI:
AUTOMATED PROCESS
TIME SAVING


CD: CONTINOUS DELIVERY/DEPLOYMENT


ENV:


PRE-PROD/NON-PROD:
DEV        : developers
QA        : testers
UAT        : clients


LIVE/PROD ENV:
PROD        : users


==> CONTINOUS DELIVERY: Deploying the application to production in manual.
===> CONTINOUS DEPLOYMENT: Deploying the application to production in automatic.




PIPELINE: 


WAKEUP -- > DAILY ACTIVITIES -- > BREAKFAST -- > LUNCH -- > CLASS
CODE -- > BUILD -- > TEST -- > ARTIFACT -- > DEPLOY


SETP BY STEP EXECUTION OF A PROCESS.
SERIES OF EVENTS INTERLINKED WITH EACHOTHER.


-------------------------------------------
JENKINS: 
ITS A FREE AND OPEN-SOURCE TOOL.
IT IS PLATFORM INDEPENDENT.
IT CAN AUTOMATE ENTIRE SDLC. 


JENKINS WRITTEN ON JAVA.
IT CONSIST OF PLUGINS.
WE HAVE COMMUNITY SUPPORT.
IT IS OWNED BY SUN MICRO SYSTEM AS HUDSON.
HUDSON IS PAID VERSION.
LATER ORACLE BROUGHT HUDSON AND MAKE IT FREE.
LATER HUDSON WAS RENAMED AS JENKINS.
INVENTOR: Kohsuke Kawaguchi
PORT NUMBER: 8080
JAVA: JAVA-17
DEFAULT PATH: /var/lib/jenkins


ALTERNATIVES:
GITLAB, BAMBOO, GO CI, CIRCLE CI, TARVIS, SEMAPHORE, BUDDY BUILD MASTER, HARNESS, ARGOCD -----


CLOUD: AWS CODEPIPELINE, AZURE PIPLEINE ---------------------




SETUP: Create an EC2 with UBUNTU 24.04 AMI and Include all traffic/8080 in sg


#! /bin/bash
sudo apt update -y
sudo apt install -y openjdk-17-jdk
java -version
curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee \
  /usr/share/keyrings/jenkins-keyring.asc > /dev/null


echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
  /etc/apt/sources.list.d/jenkins.list > /dev/null
sudo apt update -y
sudo apt install -y jenkins
sudo systemctl start jenkins
sudo systemctl status jenkins




54.172.145.179


CONNECT:
copy-public-ip:8080 (browser)
cat /var/lib/jenkins/secrets/initialAdminPassword (server)
paster password on browser -- > installing plugins --- > user details -- > save --> save -- > start using jenkins


MANAGE JENKINS (SETTINGS SYMBOL) -- > TOOLS -- > ADD MAVEN -- > name: maven -- > SAVE


JOB: it is used to perform task.
to do any work or task in jenkins we need to create a job.


to run commands we need to select execute shell on build steps.


build now: to run job
workspace: place where our job outputs will store


CREATING A JOB:
NEW ITEM -- > NAME: ci-job -- > FREESTYLE -- > OK -- > SCM -- > GIT -- > REPOURL: https://github.com/devopsbyraham/jenkins-java-project.git -- >Build Steps -- > ADD Build Steps -- > Invoke top-level Maven targets -- > Maven Version: maven -->  clean package -- > save -- > build now


WORKSPACE: where your job output is going to be stored
Default: /var/lib/jenkins/workspace




CUSTOM WORKSPACE: 
GO TO JOB -- > CONFIGURE -- > Advance Options -- > Use custom workspace -- > /root/raham


cd 
mkdir raham
chown jenkins:jenkins /root
chown jenkins:jenkins /root/raham


Now we can see output on root folder after building.


CUSTOM PORT NUMBER:
IF A TOOL IS HAVING A PORT NUMBER WE NEED TO CALL IT AS SERVICE
FOR EVERY SERVICE WE HAVE A CONFIGURATION FILE.
TO CHANGE ANY PROPERTY OF A SERVICE WE NEED TO MODIFY THE CONFIG FILE.


find / -name jenkins.service


vim /usr/lib/systemd/system/jenkins.service
LINE 72: 8080=8090
systemctl daemon-reload
systemctl restart jenkins


=============================================================================




INSTALLING MAVEN ON JENKINS
Dashboard
Manage Jenkins
Tools
Maven installations
name: maven
save


CRON JOB: We can schedule the jobs that need to be run at particular intervals.
here we use cron syntax
cron syntax has * * * * *
each * is separated by space


*        : minutes
*        : hours
*        : date
*        : month
*        : day of week (sun=0, mon=1 ----)




6:32 PM 15 JULY 2025


32 18 15 7 2


create a ci job -- > Build Triggers -- > Build periodically -- > * * * * * -- > save


CRONTAB-GENERATOR: https://crontab-generator.org/


limitation: it will not check the code is changed or not.


POLL SCM: 
in pollscm we will set time limit for the jobs.
if dev commit the code it will wait until the time is done.
in given time if we have any changes on code it will generate a build


create a ci job -- > Build Triggers -- > poll scm -- > * * * * * -- > save
commit the changes in GitHub then wait for 1 min.


LIMITATION:
1. in pollscm, we need to wait for the time we set.
2. we will get the last commit only.


WEBHOOK: it will trigger build the moment we change the code.
here we need not to wait for the build.


create ci job -- > Build Triggers: GitHub hook trigger for GITScm polling -- > save


repo on github -- > settings -- > webhooks -- > add webhook -- > Payload URL (jenkins url) -- > http://35.180.46.134:8080/github-webhook/  -- > Content type -- > application/json -- > add






BUILD SCRIPTS: to make jenkins builds from remote loc using script/
give token 
give url on other browser.
create ci job -- > Build Triggers: Trigger builds remotely -- > token -- > save




THROTTLE BUILD:


To restrict the builds in a certain time or intervals.
if we dont restrict due to immediate builds jenkins might crashdown.


POINT-1:
by default jenkins will not do concurrent builds.
we need to enable this option in configuration.

Execute concurrent builds if necessary -- > tick it


POINT-2:
MAX BY DEFAULT JENKINS CAN DO 2 BUILDS
IF I WANT MAKE 4 BUILDS AT A TIME




Jenkins -- > Build Executor Status -- > 
Built-In Node
Configure
Number of executors :4
save 






 
create a ci job -- > configure -- > Throttle builds -- > Number of builds: 3 -- > time period : hours -- > save


now it will take 20 minutes of gap for each build.


IF JENKINS GOT CRASHED
STOP THE SERVER AND START IT AFTER 2 MINS
        
NOTE: chkconfig jenkins on
it will restart Jenkins automatically








CUSTOM THEMES:


dashboard -- > manage Jenkins  -- > PLUGINS -- > Simple Them & Customizable Header -- > SELECT AND INSTALL ALL OF THEM -- >  
manage Jenkins -- > Appearance -- Customizable theme -- > ADD & CSS
https://github.com/alefnode/jenkins-themes (TO GET DIFFERENT THEMS)


https://cdn.rawgit.com/afonsof/jenkins-material-theme/gh-pages/dist/material-cyan.css


ADD HEADERS OF NARESHIT AND USE LOGO FROM IMAGES.


==========================================================================================


MASTER AND SLAVE:
it is used to distribute the builds.
it reduce the load on jenkins server.
communication blw master and slave is ssh.
Here we need to install agent (java).
SLAVE IS your instance.
slave can use any platform.
label = way of assigning work for slave.




SETUP:
#STEP-1 : Create a server and install  JAVA-1.8.0 maven
sudo apt update
sudo apt install -y wget gnupg
wget -qO - https://repos.azul.com/azul-repo.key | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/azul.gpg
echo "deb https://repos.azul.com/zulu/deb stable main" | sudo tee /etc/apt/sources.list.d/zulu.list
sudo apt update
sudo apt install -y zulu8-jdk
sudo apt install -y maven




sudo apt install -y openjdk-17-jdk
update-alternatives --config java
set java to version17


#STEP-2: SETUP THE SLAVE SERVER
Dashboard -- > Manage Jenkins -- > Nodes  -- > New node -- > nodename: abc -- > permanent agent -- > save 


CONFIGURATION OF SALVE:


Number of executors : 3 #Number of Parallel builds
Remote root directory : /tmp #The place where our output is stored on slave sever.
Labels : one #place the op in a particular slave
useage: last option
Launch method : last option 
Host: (your privte ip)
Credentials -- > add -- >jenkins -- > Kind : ssh username with privatekey -- > username: ubuntu
privatekey : pemfile of server -- > save -- > 
Host Key Verification Strategy: last option


STEP-3: BUILD JOB ON SLAVE 


DASHBOARD -- > JOB -- > CONFIGURE -- > RESTRTICT WHERE THIS JOB RUN -- > LABEL: SLAVE1 -- > SAVE




TOMCAT:


WEBSITE: FRONTEND -- > DB IS OPT
WEBAPP: FRONTEND + BACKEND -- > DB IS MANDATORY


WEB APPLICATION SERVER/APPLICATION SERVER/APP SERVER = TOMCAT


ITS A WEB APPLICATION SERVER USED TO DEPLOY JAVA APPLICATIONS.
IT IS WRITTEN ON JAVA LANGUAGE.
AGENT: JAVA
PORT: 8080
WE CAN DEPLOY OUR ARTIFACTS.
ITS FREE AND OPENSOURCE.
Its Platform Independent.
YEAR: 1999 


war : tomcat/webapps
jar : tomcat/lib


ALTERNATIVES: NGINX, IIS, WEBSPHERE, JBOSS, GLASSFISH, WEBLOGIC


NOTE: USE SLAVE AS TOMCAT FOR TEMP
SETUP: CREATE A NEW SERVER
INSTALL JAVA: sudo apt install -y openjdk-17-jdk






STEP-1: DOWNLOAD TOMCAT (dlcdn.apache.org)
wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.109/bin/apache-tomcat-9.0.109.tar.gz


STEP-2: EXTRACT THE FILES
tar -zxvf apache-tomcat-9.0.109.tar.gz


STEP-3: CONFIGURE USER, PASSWORD & ROLES
vim apache-tomcat-9.0.109/conf/tomcat-users.xml


 56   <role rolename="manager-gui"/>
 57   <role rolename="manager-script"/>
 58   <user username="tomcat" password="raham123" roles="manager-gui, manager-script"/>


STEP-4: DELETE LINE 21 AND 22
vim apache-tomcat-9.0.109/webapps/manager/META-INF/context.xml


STEP-5: STARTING TOMCAT
sh apache-tomcat-9.0.109/bin/startup.sh


CONNECTION:
COPY PUBLIC IP:8080 
manager apps -- > username: tomcat & password: raham123


SCRIPT:


#! /bin/bash
wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.109/bin/apache-tomcat-9.0.109.tar.gz
tar -zxvf apache-tomcat-9.0.109.tar.gz
sed -i '56  a\<role rolename="manager-gui"/>' apache-tomcat-9.0.109/conf/tomcat-users.xml
sed -i '57  a\<role rolename="manager-script"/>' apache-tomcat-9.0.109/conf/tomcat-users.xml
sed -i '58  a\<user username="tomcat" password="raham123" roles="manager-gui, manager-script"/>' apache-tomcat-9.0.109/conf/tomcat-users.xml
sed -i '59  a\</tomcat-users>' apache-tomcat-9.0.109/conf/tomcat-users.xml
sed -i '56d' apache-tomcat-9.0.109/conf/tomcat-users.xml
sed -i '21d' apache-tomcat-9.0.109/webapps/manager/META-INF/context.xml
sed -i '22d'  apache-tomcat-9.0.109/webapps/manager/META-INF/context.xml
sudo sh apache-tomcat-9.0.109/bin/startup.sh


DEPLOYING THE APP:
WORKSPACE IN JENKINS DASHBOARD
TARGET 
CLICK ON 
NETFLIX-1.2.2.war        


GO TO TOMCAT
CLICK ON WAR file to deploy - > CHOOSE FILE -- > UPLOAD NETFLIX WAR -- > DEPLOY 


==============================================================================================================


PIPELINE: STEP BY EXECUTION OF A PROCESS
SERIES OF EVENTS INTERLINKED WITH EACH OTHER.


code -- > build -- > test -- > artifact -- > deployment
              CI-PIPELINE                  CD-PIPELINE
|--------------------------------------||----------------|




IF PIPELINE FAILS ON STAGE-1 IT WONT GO FOR STAGE-2.


plugin download:
Dashboard
Manage Jenkins
Plugins
available 
pipeline stage view
install
Restart 




why to use ?
to automate the work.
to have clarity about the stage.


TYPES:
1. DECLARATIVE
2. SCRIPTED


pipeline syntax:
We use Groovy Script for jenkins Pipeline.
it consists of blocks that include stages.




SHORTCUT: PASSS


P        : PIPELINE
A        : AGENT
S        : STAGES
S        : STAGE
S        : STEPS 




SINGLE STAGE: this pipeline will have only one stage.


EX-1:
pipeline {
    agent any 
    
    stages {
        stage('abc') {
            steps {
               sh 'touch file1'
            }
        }
    }
}


EX-2:
pipeline {
    agent any 
    
    stages {
        stage('raham') {
            steps {
                sh 'touch file2'
            }
        }
    }
}


MULTI STAGE: this pipeline will have more than one stage.


pipeline {
    agent any
    
    stages {
        stage ('two') {
            steps {
                sh 'lsblk'
            }
        }
        stage ('three') {
            steps {
                sh 'lscpu'
            }
        }
        stage ('four') {
            steps {
                sh 'lsmem'
            }
        }
    }
}




CI PIPELINE:


CODE + BUILD + TEST + ARTIFACT


pipeline {
    agent any
    
     
    tools {
        maven 'maven'
    }


    stages {
        stage ('checkout') {
            steps {
                git 'https://github.com/devopsbyraham/jenkins-java-project.git'
            }
        }
        stage ('build') {
            steps {
                sh 'mvn compile'
            }
        }
        stage ('test') {
            steps {
                sh 'mvn test'
            }
        }
        stage ('artifact') {
            steps {
                sh 'mvn package'
            }
        }
    }
}




PIPELINE AS A CODE: Running more than one command/action inside a single stage.
to reduce the length of the code.
to save the time.


pipeline {
    agent any
    
     
    tools {
        maven 'maven'
    }


    stages {
        stage ('checkout') {
            steps {
                git 'https://github.com/devopsbyraham/jenkins-java-project.git'
                sh 'mvn compile'
                sh 'mvn test'
                sh 'mvn package'
            }
        }
    }
}


MULTI STAGE PIPELINE AS A CODE: Running more than one command/action in multiple stages.




pipeline {
    agent any
    
     
    tool {
        maven 'maven'
    }


    stages {
        stage ('one') {
            steps {
                git 'https://github.com/devopsbyraham/jenkins-java-project.git'
                sh 'mvn compile'
            }
        }
        stage ('two') {
            steps {
                sh 'mvn test'
                sh 'mvn package'
            }
        }
    }
}


PAAC OVER SINGLE SHELL: Running all the shell commands on a single shell.


pipeline {
    agent any
    
    tools {
        maven 'maven'
    }
    
    stages {
        stage ('checkout') {
            steps {
                git 'https://github.com/devopsbyraham/jenkins-java-project.git'
                sh '''
                mvn compile
                mvn test
                mvn clean package
                '''
            }
        }
    }
}




INPUT PARAMETERS: BASED ON USER INPUT THE PIPELINE IS GOING TO EXECUTE.
used to avoid the mistakes.
pipeline will wait until we provide the input.


pipeline {
    agent any
    
    tools {
        maven 'maven'
    }


    stages {
        stage ('checkout') {
            steps {
                git 'https://github.com/devopsbyraham/jenkins-java-project.git'
            }
        }
        stage ('build') {
            steps {
                sh 'mvn compile'
            }
        }
        stage ('test') {
            steps {
                sh 'mvn test'
            }
        }
        stage ('artifact') {
            steps {
                sh 'mvn package'
            }
        }
        stage ('deploy') {
            input {
                message "is your inputs correct ?"
                ok "yes"
            }
            steps {
                echo "my code is deployed"
            }
        }
    }
}


NOTE: In real time providing manual approval is best practise for Jenkins pipelines.


NOTE: if we have syntax issue none of the stages will execute.




TERRAFORM  PIPELINE:


CREDENTIALS ADDING


MANAGE JENKINS
CREDENTIALS
GLOBAL
ADD CREDENTIALS
KIND: SECERTE TEXT
AWS_ACCESS_KEY_ID: VALUE -- > id: accesskey
AWS_SECRET_ACCESS_KEY: VALUE -- > id: secretkey




pipeline {
    agent any
     
    environment {
        AWS_ACCESS_KEY_ID = credentials('accesskey')
        AWS_SECRET_ACCESS_KEY = credentials('secretkey')
    }
    
    stages {
        stage('Code') {
            steps {
                git branch: 'main', url: 'https://github.com/RAHAMSHAIK007/rahamterrarepo.git'
            }
        }
        stage('init') {
            steps {
                sh 'terraform init'
            }
        }
        stage('validate') {
            steps {
                sh 'terraform validate'
            }
        }
        stage('plan') {
            steps {
                sh 'terraform plan'
            }
        }
        stage('apply') {
            input {
                message "is everything fine ?"
                ok "yes"
            }
            steps {
                sh 'terraform $action -auto-approve'
            }
        }


    }
}




DIFF BLW SCRIPTED VS DECLARATVE


SCRIPTED:         DECLARATIVE: 
SHORT           LONG
NO STAGES       IT HAS STAGES
START NODE      START WITH PIPELINE


================================================================================================
ARTIFACTORY ON NEXUS AND S3


NEXUS:
Its an Artifactory storage service.
used to store artifacts on repo. (.JAR, .WAR, .EAR)
Nexus server -- > Repo -- > Artifact
we can use this server to rollback in real time.
it req t2.medium  & 30 GB EBS
nexus uses java-17
PORT: 8081
NOTE: ALLOW REDPLOY POLICY TO STORE WAR FILE MULTIPLE TIMES.




ALTERTAVIVES: JFROG, S3, -----


STEP-1: CREATE A UBUNTU SERVER WITH T2.MEDIUM AND 30 GB EBS


STEP-2: EXECUTE THE BELOW SCRIPT ON SERVER
apt update
apt install wget tar -y
wget https://download.sonatype.com/nexus/3/nexus-unix-x86-64-3.79.0-09.tar.gz
tar -zxvf nexus-unix-x86-64-3.79.0-09.tar.gz
sudo apt install openjdk-17-jre
sudo useradd nexus
sudo chown -R  nexus:nexus  nexus-3.79.0-09
sudo sh nexus-3.79.0-09/bin/nexus start




SETUP SCIPT:
https://github.com/RAHAMSHAIK007/all-setups.git


STEP-3: CONFIGURE NEXUS SERVER
copy-public-ip:8081 (browser)


STEPS: signin -- > username: admin & password: /app/sonatype-work/nexus3/admin.password -- > next -- > set password -- > disable anonymous access -- > save


CREATING REPO:
settings symbol -- > repositories -- > new -- > maven2(hosted) -- > name -- > save


NOTE: to integrate any tool with Jenkins we need to download the plugin.


STEP-4: INTEGRATING NEXUS TO PIPELINE


NEXUS INTEGRATION TO PIPELINE:
1. Download the plugin (Nexus Artifact Uploader)
Manage Jenkins -- > plugins -- > Available Plugins -- > Nexus Artifact Uploader -- > install.
2. Configure it to pipeline by using pipeline syntax
search for nexus


NOTE: All the information will be available on pom.xml file.


ADDING CREDS:
Dashboard
Manage Jenkins
Credentials
global
Add creds




PIPELINE:


pipeline {
    agent any
    
    stages {
        stage('checkout') {
            steps {
                git 'https://github.com/devopsbyraham/jenkins-java-project.git'
            }
        }
        stage('build') {
            steps {
                sh 'mvn compile'
            }
        }
        stage('test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('artifact') {
            steps {
                sh 'mvn package'
            }
        }
        stage('Artifact upload') {
            steps {
                nexusArtifactUploader artifacts: [[artifactId: 'NETFLIX', classifier: '', file: 'target/NETFLIX-1.2.2.war', type: '.war']], credentialsId: '968c23dd-b648-4f15-91bf-7d76981a1218', groupId: 'in.RAHAM', nexusUrl: '100.25.197.110:8081', nexusVersion: 'nexus3', protocol: 'http', repository: 'netflix', version: '1.2.2'
            }
        }
    }
}






INTEGRTAING S3 WITH JENKINS:
1. installing s3 publisher plugin.
2. configure s3profile 
(Manage Jenkins -- > System -- > s3 profile -- > give creds -- > test -- > save)


3. use pipeline syntax to give details(select s3 upload)
PROFILE: raham
SOURCE: target/NETFLIX-1.2.2.war
Destination bucket: BUCKET NAME
Bucket Region: REGION


NOTE: DONT GIVE SPACE FOR BUCKET NAME


aws s3api put-bucket-versioning --bucket my_bucket --versioning-configuration Status=Enabled






pipeline {
    agent any
    
    stages {
        stage('code') {
            steps {
                git branch: '$branch', url: 'https://github.com/RAHAMSHAIK007/jenkins-java-project.git'
            }
        }
        stage('build') {
            steps {
                sh 'mvn compile'
            }
        }
        stage('test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('code quality') {
            steps {
                echo " my code is done with code quality testing"
            }
        }
        stage('artifact') {
            steps {
               sh 'mvn clean package' 
            }
        }
        stage('s3') {
            steps {
                s3Upload consoleLogLevel: 'INFO', dontSetBuildResultOnFailure: false, dontWaitForConcurrentBuildCompletion: false, entries: [[bucket: 'netflixwarfiles3bucket', excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: false, selectedRegion: 'us-east-1', showDirectlyInBrowser: false, sourceFile: 'target/NETFLIX-1.2.2.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false]], pluginFailureResultConstraint: 'FAILURE', profileName: 'raham', userMetadata: []
            }
        }
        stage('deploy') {
            steps {
                deploy adapters: [
                    tomcat9(credentialsId: 'a333c89f-d56f-49d7-8630-eeceaf165b5f', path: '', url: 'http://13.217.161.148:8080/')
                ],
                contextPath: 'raham',
                war: 'target/*.war'
            }
        }
    }
}




In summary: S3 wins for minimal cost and maintenance, especially for storing WAR files for real-time access. 




DOWNLOAD PLUGIN CALLED PERIDOIC BACKUP




Dashboard
Manage Jenkins
Periodic Backup Manager
Configure




Temporary Directory                 : /tmp
Backup schedule (cron)                 : 0 2 * * *
Maximum backups in location         : 10
Store no older than (days)         : 7
File Management Strategy         : FullBackup
Storage Strategy                 : zip Format
 


==================================================================================================================================






RBAC:


RBAC: ROLE BASE ACCESS CONTROL.
TO restrict the user PERMISSIONS in jenkins.


fresher1= fresher
raham        = exp 


STEP-1: USER CREATION
manage jenkins -- > users -- > create users -- > suresh: fresher 


STEP-2: PLUGIN DOWNLOADING
Dashboard
Manage Jenkins
Plugins
Available plugin
Role-based Authorization Strategy  


STEP-3: CONFIGURE THE PLUGIN
Dashboard
Manage Jenkins
Security
Authorization 
Role-based  Strategy  
SAVE


STEP-4: MANAGE AND ASSIGN ROLES TO USERS
manage roles -- > add -- > fresher  -- > fresher: overall read & job:read -- > save
assign roles -- > add user -- > yesudas: fresher -- > save




RESTRICTING TO SPECIFIC JOB:
MANAGE JENKINS -- > SECURITY --> AUTHORIZATION -- > PROJECT BASED MATRIX AUTHORIZATION STRATEGY -- > ADD USER -- > YESUDAS -- > Overall Read




GO TO JOB -- > Enable project-based security
ADD USER -- > YESUDAS 
JOB: BUILD & READ
SAVE




HOW TO ADD PARAMETERS:


PARAMETERS: Used to pass inputs for jobs


CHOICE: to pass single input at a time. (99%)
STRING: to pass multiple inputs at a time. (1%)
------------
MULTI-LINE STRING: to pass multiple inputs on multiple lines at a time.
FILE: to pass the file as input.
BOOL: to pass input either yes or no.




This project is parameterized
Name: branch 
Choices: 
dev
test
save




BACKUP:






TOMCAT INEGRATION:
STEP-1: INSTALL TOMCAT ON SERVER
STEP-2: DOWNLOAD PLUGIN (Deploy to Container)
STEP-3: CREDS ADDING: 
Dashboard
Manage Jenkins
Credentials
System
Global credentials (unrestricted)
Add credentials 
username & password
save




pipeline {
    agent any
    
    tools {
        maven 'maven'
    }
    stages {
        stage('code') {
            steps {
                git branch: '$branch', url: 'https://github.com/RAHAMSHAIK007/jenkins-java-project.git'
            }
        }
        stage('build') {
            steps {
                sh 'mvn compile'
            }
        }
        stage('test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('artifact') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('s3') {
            steps {
                s3Upload consoleLogLevel: 'INFO', dontSetBuildResultOnFailure: false, dontWaitForConcurrentBuildCompletion: false, entries: [[bucket: 'mynetflixartifactbucket007', excludedFile: '', flatten: false, gzipFiles: false, keepForever: false, managedArtifacts: false, noUploadOnFailure: false, selectedRegion: 'us-east-1', showDirectlyInBrowser: false, sourceFile: 'target/NETFLIX-1.2.2.war', storageClass: 'STANDARD', uploadFromSlave: false, useServerSideEncryption: false]], pluginFailureResultConstraint: 'FAILURE', profileName: 'raham', userMetadata: []
            }
        }
        stage('deploy') {
            steps {
                deploy adapters: [
                    tomcat9(
                        credentialsId: '6d2b07d2-3027-435c-b243-8ff6067d9e63', 
                        url: 'http://98.85.254.168:8080/'
                    )
                ],
                    contextPath: 'netflix',
                    war: 'target/NETFLIX-1.2.2.war'
            }
        }
    }
}
============================================================================================================


CREDS ADDING: 
Dashboard
Manage Jenkins
Credentials
System
Global credentials (unrestricted)
Add credentials 
username & pasword


STEPS FOR PROJECT:


STEP-1: WE CREATE THE CLIENT ACCOUNT IN AWS. [aws orginization]


STEP-2: CREATE THE INFRASTRUCTURE FROM HCP.
        Link: https://github.com/devopsbyraham/netflixdemoinfra.git


provider "aws" {
region = "us-east-1"
}


resource "aws_instance" "one" {
count = 4
ami = "ami-04aa00acb1165b32a"
instance_type = "t2.medium"
key_name = "argocd"
vpc_security_group_ids = ["sg-06785bc60f40dceda"]
tags = {
Name = var.instance_names[count.index]
}
}


variable "instance_names" {
default = ["jenkins", "APPSERVER-1", "APPSERVER-2", "Monitoring server"]
}


AWS_ACCESS_KEY_ID : VALUE: Environment variable -- >  SENSITIVE -- > SAVE 
AWS_SECRET_ACCESS_KEY: Environment variable -- > SENSITIVE -- > SAVE 
NOTE: MARK THEM AS ENV VARIBALE AND MAKE SURE NO SPACES ARE GIVEN






STEP-3: CONFIGURE THE SEVERS [SCRIPTS] [JENKINS, TOMCAT, S3, MONITORING]
        Link: https://github.com/RAHAMSHAIK007/all-setups.git


SETP-4: WRITE PIPELINE FOR CI/CD.
        A. Configure Slave
        B. Download Plugins [pipeline stage view, s3, Deploy to container, slack] 
        C. Write Pipeline Code


SETP-5: INTEGRATE TO SLACK


STEP-6: MONITOR THE APPLICATION FROM GRAFANA 


TOOLS:
GIT
GITHUB
MAVEN
JENKINS
NEXUS
TOMCAT
HCP
TERRAFORM
SLACK
PROMETHEUS
GRAFANA


PIPELINE CODE:


pipeline {
    agent any
    
    stages {
        stage('checkout') {
            steps {
                git branch: '$branch', url: 'https://github.com/devopsbyraham/jenkins-java-project.git'
            }
        }
        stage('build') {
            steps {
                sh 'mvn compile'
            }
        }
        stage('test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('artifact') {
            steps {
                sh 'mvn package'
            }
        }
        stage('Nexus') {
            steps {
                nexusArtifactUploader artifacts: [[artifactId: 'NETFLIX', classifier: '', file: 'target/NETFLIX-1.2.2.war', type: '.war']], credentialsId: '35cc5458-5e5a-4992-8e90-394d9a3c9ab1', groupId: 'in.RAHAM', nexusUrl: 'ec2-3-80-145-80.compute-1.amazonaws.com:8081', nexusVersion: 'nexus3', protocol: 'http', repository: 'abcd', version: '1.2.2'
            }
        }
        stage('deploy') {
            steps {
                deploy adapters: [
                    tomcat9(
                        credentialsId: '85e5e800-4740-461a-868d-519b51fa90ed',
                        path: '',
                        url: 'http://ec2-54-234-53-68.compute-1.amazonaws.com:8080/'
                    )
                ],
                contextPath: 'netflix',
                war: 'target/*.war'
            }
        }
    }
    post {
        always {
            echo "slack notify"
            slackSend (
                 channel: '#netflix', message: "*${currentBuild.currentResult}:* Job ${env.JOB_NAME} \n build ${env.BUILD_NUMBER} \n More info at: ${env.BUILD_URL}"
            )
        }
    }
}


PATH FOR PROMTHEUS: vim /etc/prometheus/prometheus.yml




======================================================


LEVEL-1: JENKINS 
PLUGINS
SYNTAX
CONFIGURATION


LEVEL-2: SERVER
GIT MAVEN JAVA PROMETHEUS (TOOL ISSUES)
FIREWALL & NETWORK
HARDWARE


LEVEL-3: CODE
LIBS
CODE SMELLS
SYNTAX OR ALLIGNEMT
